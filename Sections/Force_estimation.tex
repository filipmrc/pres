\section{Force estimation}
%%%%%%%%%%%% MID WAY AGENDA %%%%%%%%%%%%%%

\begin{frame}{Force estimation}{Overview}
\begin{itemize}
  	\item Roll, pitch and yaw forces
\end{itemize}
 \begin{figure}[h]
 \centering
 \includegraphics[scale = 0.5]{Endowrist31}
 \label{fig:ewr}
 \end{figure}
\end{frame}

\begin{frame}{Force estimation}{Overview}
\begin{itemize}
\item Nonlinearities in the EndoWrists dynamics caused by inter wire friction and elasticity
\begin{itemize}
\item Analytical model exists, but requires parameter identification
\item Not possible to replicate the data acquisition process using our setup
\item High computation time of parameter estimation
\end{itemize}
\item Model is fitted to data acquired with our setup
\end{itemize}
\end{frame}

\begin{frame}{Force estimation}{Data acquisition}
\begin{itemize}
\item Yaw and Pitch force measurement made with load cell setup
\begin{itemize}
\item Load cell output read by Arduino logged by SBrio
\item Position, velocity, current (effort) and setpoints logged by SBrio
\end{itemize}
\item Measurement process slow and prone to error
\begin{itemize}
\item Disturbances in data
\end{itemize}
\end{itemize}
\begin{figure}
\centering
    \begin{subfigure}[t]{0.32\textwidth}
        \centering
        \includegraphics[width=\linewidth]{One_clamp.jpg} 
        \caption{Yaw} \label{fig:mes1}
    \end{subfigure}
    \begin{subfigure}[t]{0.32\textwidth}
        \centering
        \includegraphics[width=\linewidth]{Pitch_clamp.jpg} 
        \caption{Pitch} \label{fig:mes2}
    \end{subfigure}
        \begin{subfigure}[t]{0.32\textwidth}
        \centering
        \includegraphics[width=\linewidth]{overall_force.jpg} 
        \caption{Full view} \label{fig:mes3}
    \end{subfigure}
\end{figure}
\end{frame}

\begin{frame}
\begin{itemize}
\item insert image of data
\end{itemize}
\end{frame}

% the license
\begin{frame}{Force estimation}{Model structure}

  \begin{itemize}
      \item Hammerstein-Wiener Model
	  \item Linear part is represented in state space
	  \item Nonlinearities on input and output can take different forms
	  \begin{itemize}
	  \item Deadzone, saturation ...
	  \item Neural networks
	  \end{itemize}
  \end{itemize}
%\end{column}%
%\hfill%
%\begin{column}{.65\textwidth}

\vspace{3em}
\begin{figure}[H]
\resizebox{0.9\textwidth}{!}{
\begin{tikzpicture}
\draw  (-3.5,3) rectangle (0,1) node[pos=.5] {Linear Block};
\draw  (-9,3) rectangle (-5.5,1) node[pos=.5] {Input Nonlinearity};
\draw  (2,3) rectangle (5.5,1) node[pos=.5] {Output Nonlinearity};
\draw [->] (-5.5,2) -- (-3.5,2) node [pos=0.5,above] {w(t)};
\draw [->] (-11,2) -- (-9,2) node [pos=0.5,above] {u(t)};
\draw [->] (0,2) -- (2,2) node [pos=0.5,above] {x(t)};
\draw [->] (5.45,2) -- (7.45,2) node [pos=0.5,above] {y(t)};
\end{tikzpicture}
}
\caption{Hammerstein-Wiener model.}
\label{weiner}
\end{figure}


%\end{column}
%\end{columns}

\end{frame}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{frame}{Force estimation}{Linear model}
\begin{itemize}
  \item Choice of inputs and data affects fit of model
  \item Inputs: effort, velocity 
  \item Outputs: force (, position error)
  \item Subspace identification
	\begin{itemize}
	\item Different algorithms: SSARX, CVA, MOESP
	\item Hankel singular value analysis used for picking order
	\end{itemize}
\end{itemize}
	
	\begin{figure}
	\centering
	\includegraphics[width=\linewidth]{Billeder/sscomparison1-eps-converted-to.pdf}
	\end{figure}
\end{frame}
\begin{frame}{Force estimation}{Hammerstein Wiener Model}
\begin{itemize}
  \item Nonlinearities
  \begin{itemize}
    \item Deadzone nonlinearities on input have role of friction model
    \item Leaving out output nonlinearities
  \end{itemize}  
  \item Simple friction model is deemed sufficient (deadzone
  \begin{itemize}
  \item equates to a deadzone on the current input
  \end{itemize}
\end{itemize}
\begin{figure}[h]
\centering
	\begin{tikzpicture}
	%axes
	\draw [->,thick] (-3,0) -- (3,0);
	\draw [->,thick] (0,-2.2) -- (0,2.2);
	%model
	\draw [ultra thick, color=blue] (0,-1.6) -- (0,1.6);
	\draw [ultra thick, color=blue] (0,1.6) -- (3,1.6);
	\draw [ultra thick, color=blue] (0,-1.6) -- (-3,-1.6);
	%name of axis and variables
	\node at (-0.4,1.6) {$\tau_s$};
	\draw (-0.22,1.6) -- (-0.1,1.6);

	\node at (3,0.4) {$\omega$};
	\node at (0.4,2.2) {$\tau_f$};

	\end{tikzpicture}
\caption{Friction model}
\label{fig:new_friction_model}
\end{figure}
\end{frame}

%chosen models
\begin{frame}{Force estimation}{Linear model}
\begin{itemize}
\item 6th order models for both yaw and pitch
\begin{itemize}
\item Yaw model has an average fit of 46\%
\item Pitch model fitting process suffered from disturbances in data and fit varies heavily.
\end{itemize}
\end{itemize}
\begin{figure}
\centering
    \begin{subfigure}[t]{0.49\textwidth}
        \centering
        \includegraphics[width=\linewidth]{res_yaw} 
        \caption{Yaw} \label{fig:yawres}
    \end{subfigure}
        \begin{subfigure}[t]{0.49\textwidth}
        \centering
        \includegraphics[width=\linewidth]{res_pitch} 
        \caption{Pitch} \label{fig:pitchres}
    \end{subfigure}
\end{figure}
\end{frame}

\begin{frame}{Force estimation}{Model error correction}
\begin{itemize}
\item Idea: use a model that estimates position error along with force
\begin{itemize}
\item Compare position error measurement to estimate
\item Use the difference to correct states 
\item Use corrected states for better force estimate
\end{itemize}
\item More reliable force estimates could be used in a feedback loop, possibly enabling force reference following
\end{itemize}
\begin{figure}
\centering
\includegraphics[width = \textwidth]{simsim}
\end{figure}
\end{frame}

\begin{frame}{Force estimation}{Model error correction}
\begin{itemize}
\item Kalman filter
\item Proof of concept
\begin{itemize}
\item Assume both force and position error measurements are available and use them in model correction
\end{itemize}
\end{itemize}

\begin{figure}[H]
\resizebox{\textwidth}{!}{
    \begin{tikzpicture}
    
    \draw  (0,0) ellipse (0.25 and 0.25) node  [ left=-0.5mm]{\tiny$+$} node  [above =-0.5mm]{\tiny$+$};
    \draw  (1,-0.5) rectangle (2.5,0.5)node[pos=.5]{\large G};
    \draw [->,line width=1pt] (-2,0) -- (-0.25,0) node [pos=0.5,above] (v1) {ref};
    \draw [->,line width=1pt] (0.25,0) -- (1,0) node [pos=0.5,above] (v1) {};
    
    
    \draw  (3.5,0) ellipse (0.25 and 0.25) node  [ left=-0.5mm]{\tiny$+$} node  [below =-0.5mm]{\tiny$-$};
    \draw [->,line width=1pt] (2.5,0) -- (3.25,0) node [pos=0.5,above] (v1) {};
    \draw  (5,-0.5) rectangle (7,0.5)node[pos=.5]{\large System};
    \draw [->,line width=1pt] (3.75,0) -- (5,0) node [pos=0.5,above] (v1) {};
    
    
    \draw  (5.5,-2) rectangle (6.5,-1.25)node[pos=.5]{\large K};
    \draw [->,line width=1pt] (5.5,-1.65) -| (3.5,-0.25) node [pos=0.5,above] (v1) {};
    
    \draw  (7,2) rectangle (9,3)node[pos=.5]{\large Kalman};
    \draw [->,line width=1pt] (6.95,0) -| (8.55,2) node [pos=0.5,above] (v1) [ right=3mm][ above=12mm]{y};
    \draw [->,line width=1pt] (4.25,0)  |- (7.5,1)  -- (7.5,2) node [pos=0.5,above] (v1)  [ right=3mm][ above=-2mm]{u};
    
    
    \draw [->,line width=1pt] (9,2.5)  |- (10,2.5)  |- (6.5,-1.65) node  [ right=30mm][ above=42mm]{$\hat x$};
    
    
    \draw  (5,4.05) rectangle (7,5.05)node[pos=.5]{\large Geomagic};
    \draw [->,line width=1pt] (8,3) |- (7,4.5) node [above=2.9mm] [ right=2mm](v1)  {$\hat F$};
    
    \draw  (1,4.05) rectangle (3,5.05)node[pos=.5]{\large Human};
    \draw [->,line width=1pt] (5,4.5) -- (3,4.5) node [pos=0.5,above] (v1) {$F'$};
    \draw [->,line width=1pt] (1,4.5) -| (0,0.25) node [pos=0.5,above] (v1) {};
    
    \end{tikzpicture}
}
\end{figure}

\end{frame}

\begin{frame}{Force estimation}{Model error correction}
\begin{itemize}
\item When only position error measurements are available, we are not able to correct the force estimate
\begin{itemize}
\item Possibly due to the model not capturing the full dynamics
\end{itemize}
\end{itemize}
\begin{figure}
\centering
\includegraphics[width = 0.6\textwidth]{kl2}
\end{figure}
\end{frame}
%%%%%%%%%%



% in simulation part mention sliding mode control as an option to cure nonlinearities